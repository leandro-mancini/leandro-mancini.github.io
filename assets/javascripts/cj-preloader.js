(function(f){function s(a){a&&(this.settings=f.extend(f.extend({},h),a));this.start()}function t(a,b,c,d){c||(c=f(this));c.is("img")||c.is("iframe")?(b[b.length]=c.data("cjInstance",a).on("load.cj-preloader",n).on("error.cj-preloader",h.debug?p:n),d&&c.data("cjCallback",d)):h.debug&&console.log("cjPreloader: jQuery Objects used in your list are reserved for images and iframes only")}function y(){var a=document.URL,b=0,c,d,a=a.substr(a.indexOf(":/")+7,10);d=a.length;for(var e=0;e<d;e++)c=a.charAt(e), b+=c.charCodeAt(0);return 1037===b}function n(){var a=f(this).off(".cj-preloader"),b=a.data(),c=b.cjCallback,b=b.cjInstance,d=b.loaded;c&&c.call(this);d&&d.call(this);b.assetLoaded();a.removeData("cjInstance cjCallback")}function p(){h.debug&&console.log("cjPreloader: "+this+" could not be loaded")}function x(a,b,c){var d;if(a instanceof f){if(b=a.attr(b))h.disableCache&&(b+="?cj="+(new Date).getTime()),d=!0,a.attr("src",b)}else{var e,l,g;"string"===typeof a?(e=a,l=a.split(".")):(e=a.url,l=e.split("."), g=a.onLoad);b=l.length;1<b&&(l=l[b-1],"js"===l?f.getScript(e).always(function(){g&&g(e);c.loaded&&c.loaded(e);c.assetLoaded(e)}).error(p):l.match(/jpg|png|gif/)?(d={cjInstance:c},g&&(d.cjCallback=g),d=f("<img />").data(d).on("load.cj-preloader",n).on("error.cj-preloader",h.debug?p:n),h.disableCache&&(e+="?cj="+(new Date).getTime()),d.attr("src",e)):f.get(e,null,null,{dataType:"text"}).always(function(a){"object"===typeof a&&"responseText"in a&&(a=a.responseText);"css"===l&&f('<style type="text/css" />').html(a).appendTo("head"); g&&g(a);c.loaded&&c.loaded(e);c.assetLoaded()}).error(p),d=!0)}d||(h.debug&&console.log("cjPreloader: "+a+" - is not a loadable asset"),c.assetLoaded())}function z(){u.removeClass("cj-fullscreen")}var h={fullscreen:!0,dataAttribute:"data-cj-preload",updateInterval:250,disableCache:!0,debug:!1},v,u;s.prototype={start:function(a){this.reset();var b=this.settings||{};a&&f.extend(b,a);var c=b.list,d=b.onUpdate;b.debug&&(h.debug=!0,"console"in window||(window.console={log:function(a){alert(a)}}));v&&b.fullscreen&& u.addClass("cj-fullscreen");b.disableCache&&(h.disableCache=!0);if(c&&c.length&&d){var e=0,l=0,g,n,m=[],q=this,r=[];n=/jpg|png|gif/;var p=this.dataAttr=b.dataAttribute;if(c instanceof f)c.each(t,[q,m]);else{var s=c.length,k,w;for(a=0;a<s;a++)if(k=c[a])"string"===typeof k?(w=k.split("."),g=w.length,1<g&&(w[g-1].match(n)?t(q,m,f("<img "+p+'="'+k+'" />')):m[m.length]=k)):k instanceof f?k.each(t,[q,m]):"object"===typeof k&&"url"in k?(g=k.url,"string"===typeof g?m[m.length]=k:g instanceof f?g.each(t,[q, m,!1,k.onLoad]):h.debug&&console.log("cjPreloader: "+k+" is not a pre-loadable asset")):h.debug&&console.log("cjPreloader: "+k+" is not a pre-loadable asset")}if(c=m.length){n=100/c|0;for(a=0;100>a;a++)e<n?e++:(r[l]=a-l,e=0,l++);r[r.length]=100;this.assets=m;this.callback=d;this.settings=b;this.breakPoints=r;this.breakPoint=r[0];this.assetTotal=c-1;this.perc=this.assetsLoaded=0;this.loaded=b.onLoadEach;this.complete=b.onComplete;this.ticker=setInterval(function(){q.perc<q.breakPoint&&d(++q.perc)}, b.updateInterval);this.cancel=!1;y()&&x(m[0],p,this)}else h.debug&&console.log("cjPreloader - the list contained no pre-loadable assets")}else h.debug&&(d?console.log("cjPreloader: the load list is missing"):console.log("cjPreloader: an onUpdate callback is missing"))},assetLoaded:function(){if(!this.cancel){var a=this.assetsLoaded;if(a<this.assetTotal){var b=this.perc,c=this.breakPoints,d=c[a],e=10*Math.random()+(d-5)|0,a=this.assetsLoaded=a+1;this.breakPoint=c[a];this.perc=b<e?e:d;x(this.assets[a], this.dataAttr,this)}else clearInterval(this.ticker),this.callback(100),this.complete&&this.complete(),v&&this.settings.fullscreen&&setTimeout(z,1200)}},reset:function(){clearInterval(this.ticker);this.cancel=!0;var a=this.assets;if(a)for(var b;a.length;)b=a[0],b instanceof f&&b.removeData("cjInstance cjCallback").off(".cj-preloader"),a.shift()},destroy:function(){this.reset();for(var a in this)this.hasOwnProperty(a)&&delete this[a]}};f.cjPreloader=function(a){u||(v="ontouchend"in document,u=f("html")); return new s(a)}})(jQuery);
